<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySql 数据库 | Touch</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.ca677ac2.css" as="style"><link rel="preload" href="/assets/js/app.a63e0d5d.js" as="script"><link rel="preload" href="/assets/js/3.997b8ea5.js" as="script"><link rel="prefetch" href="/assets/js/10.fa6dee60.js"><link rel="prefetch" href="/assets/js/11.efd579f8.js"><link rel="prefetch" href="/assets/js/12.3fd57417.js"><link rel="prefetch" href="/assets/js/13.dbfcf37c.js"><link rel="prefetch" href="/assets/js/14.bdaf17b7.js"><link rel="prefetch" href="/assets/js/15.731c2856.js"><link rel="prefetch" href="/assets/js/16.b12fb4e0.js"><link rel="prefetch" href="/assets/js/17.2a8aa650.js"><link rel="prefetch" href="/assets/js/18.e8bc0c95.js"><link rel="prefetch" href="/assets/js/19.3810dc27.js"><link rel="prefetch" href="/assets/js/2.d2fb46e5.js"><link rel="prefetch" href="/assets/js/20.db3e74b1.js"><link rel="prefetch" href="/assets/js/21.ba1784d6.js"><link rel="prefetch" href="/assets/js/4.8e75ca09.js"><link rel="prefetch" href="/assets/js/5.b2410f5e.js"><link rel="prefetch" href="/assets/js/6.54b30c28.js"><link rel="prefetch" href="/assets/js/7.8d2757c9.js"><link rel="prefetch" href="/assets/js/8.05ab7973.js"><link rel="prefetch" href="/assets/js/9.ed01ab1f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ca677ac2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Touch</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/golang.html" class="nav-link">golang</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/redis.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/mogodb.html" class="nav-link">mogodb</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/database.html" class="nav-link router-link-exact-active router-link-active">mysql</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/web.html" class="nav-link">web</a></li></ul></div></div><div class="nav-item"><a href="/peddle_self/production/document.html" class="nav-link">数据库表</a></div><div class="nav-item"><a href="/arithmetic/home.html" class="nav-link">算法</a></div><div class="nav-item"><a href="/jtoobjc/jtoobjc.html" class="nav-link">j2objc</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">issue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/issue/vue.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/issue/golang.html" class="nav-link">golang</a></li></ul></div></div><div class="nav-item"><a href="/weekpapers/weekpaper.html" class="nav-link">工作周报</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/golang.html" class="nav-link">golang</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/redis.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/mogodb.html" class="nav-link">mogodb</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/database.html" class="nav-link router-link-exact-active router-link-active">mysql</a></li><li class="dropdown-item"><!----> <a href="/peddle_self/dashboard/web.html" class="nav-link">web</a></li></ul></div></div><div class="nav-item"><a href="/peddle_self/production/document.html" class="nav-link">数据库表</a></div><div class="nav-item"><a href="/arithmetic/home.html" class="nav-link">算法</a></div><div class="nav-item"><a href="/jtoobjc/jtoobjc.html" class="nav-link">j2objc</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">issue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/issue/vue.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/issue/golang.html" class="nav-link">golang</a></li></ul></div></div><div class="nav-item"><a href="/weekpapers/weekpaper.html" class="nav-link">工作周报</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/peddle_self/dashboard/database.html" class="active sidebar-link">MySql 数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/peddle_self/dashboard/database.html#golang-使用-三方库调用-mysql-数据库" class="sidebar-link">golang 使用 三方库调用 mysql 数据库</a></li><li class="sidebar-sub-header"><a href="/peddle_self/dashboard/database.html#执行查询" class="sidebar-link">执行查询</a></li><li class="sidebar-sub-header"><a href="/peddle_self/dashboard/database.html#problem" class="sidebar-link">problem</a></li><li class="sidebar-sub-header"><a href="/peddle_self/dashboard/database.html#各种方式效率分析" class="sidebar-link">各种方式效率分析</a></li><li class="sidebar-sub-header"><a href="/peddle_self/dashboard/database.html#golang-数据库模型图" class="sidebar-link">golang 数据库模型图</a></li><li class="sidebar-sub-header"><a href="/peddle_self/dashboard/database.html#数据库数据为-null-的问题" class="sidebar-link">数据库数据为 null 的问题</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="mysql-数据库"><a href="#mysql-数据库" aria-hidden="true" class="header-anchor">#</a> MySql 数据库</h1> <h2 id="golang-使用-三方库调用-mysql-数据库"><a href="#golang-使用-三方库调用-mysql-数据库" aria-hidden="true" class="header-anchor">#</a> golang 使用 三方库调用 mysql 数据库</h2> <ol><li>引入三方库</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>go <span class="token keyword">get</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>go<span class="token operator">-</span>sql<span class="token operator">-</span>driver<span class="token operator">/</span>mysql
</code></pre></div><ol start="2"><li>导入库
go get -u github.com/go-sql-driver/mysql</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;database/sql&quot;</span>
<span class="token keyword">import</span> _ <span class="token string">&quot;github.com/go-sql-driver/mysql&quot;</span>
</code></pre></div><ol start="3"><li>连接数据库</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">,</span> err <span class="token punctuation">:</span><span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root@/uestcbook&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="执行查询"><a href="#执行查询" aria-hidden="true" class="header-anchor">#</a> 执行查询</h2> <ol><li>exec<div class="language-js extra-class"><pre class="language-js"><code>result<span class="token punctuation">,</span> err <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>
 <span class="token string">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><span class="token punctuation">,</span>
 <span class="token string">&quot;gopher&quot;</span><span class="token punctuation">,</span>
 <span class="token number">27</span><span class="token punctuation">,</span>
 <span class="token punctuation">)</span>
</code></pre></div></li> <li>Query<div class="language-js extra-class"><pre class="language-js"><code> rows<span class="token punctuation">,</span> err <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name FROM users WHERE age = ?&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span>
   <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">var</span> name string
       <span class="token keyword">if</span> err <span class="token punctuation">:</span><span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
           log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
       fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s is %d\n&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span> err <span class="token punctuation">:</span><span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code></pre></div></li> <li>QueryRow</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> age int64
  row <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">QueryRow</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT age FROM users WHERE name = ?&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
 err <span class="token punctuation">:</span><span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>age<span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li><p>Prepared statements</p> <div class="language-js extra-class"><pre class="language-js"><code>age <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">27</span>
stmt<span class="token punctuation">,</span> err <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name FROM users WHERE age = ?&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
rows<span class="token punctuation">,</span> err <span class="token punctuation">:</span><span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>
<span class="token comment">// process rows</span>
</code></pre></div></li> <li><p>事物</p> <div class="language-js extra-class"><pre class="language-js"><code> tx<span class="token punctuation">,</span> err <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
   log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="problem"><a href="#problem" aria-hidden="true" class="header-anchor">#</a> problem</h2> <h3 id="unknown-driver-mysql-forgotten-import"><a href="#unknown-driver-mysql-forgotten-import" aria-hidden="true" class="header-anchor">#</a> unknown driver &quot;mysql&quot; (forgotten import?)</h3> <ol><li>头部引用</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>_ <span class="token string">&quot;github.com/go-sql-driver/mysql&quot;</span>
</code></pre></div><h2 id="各种方式效率分析"><a href="#各种方式效率分析" aria-hidden="true" class="header-anchor">#</a> 各种方式效率分析</h2> <h3 id="db-exec和statement-exec和tx-exec的区别？"><a href="#db-exec和statement-exec和tx-exec的区别？" aria-hidden="true" class="header-anchor">#</a> db.exec和statement.exec和tx.exec的区别？</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;strconv&quot;</span>
    <span class="token string">&quot;database/sql&quot;</span>
    _ <span class="token string">&quot;github.com/go-sql-driver/mysql&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;time&quot;</span>
    <span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token operator">&amp;</span>sql<span class="token punctuation">.</span><span class="token constant">DB</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

func <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    db<span class="token punctuation">,</span>_ <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root:root@/book&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 

func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

func <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//方式1 update</span>
    start <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;UPdate user set age=? where uid=? &quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式1 update total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式2 update</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1101</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1200</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;UPdate user set age=? where uid=? &quot;</span><span class="token punctuation">)</span>
        stm<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
        stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式2 update total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式3 update</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;UPdate user set age=? where uid=?&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1201</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1300</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        stm<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式3 update total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式4 update</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1301</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1400</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;UPdate user set age=? where uid=?&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式4 update total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式5 update</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1401</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1500</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;UPdate user set age=? where uid=?&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
        tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式5 update total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token punctuation">}</span>

func <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//方式1 delete</span>
    start <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM USER WHERE uid=?&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式1 delete total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式2 delete</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1101</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1200</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM USER WHERE uid=?&quot;</span><span class="token punctuation">)</span>
        stm<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式2 delete total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式3 delete</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM USER WHERE uid=?&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1201</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1300</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        stm<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式3 delete total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式4 delete</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1301</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1400</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM USER WHERE uid=?&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式4 delete total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式5 delete</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1401</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1500</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM USER WHERE uid=?&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
        tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式5 delete total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token punctuation">}</span>

func <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
    <span class="token comment">//方式1 query</span>
    start <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    rows<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT uid,username FROM USER&quot;</span><span class="token punctuation">)</span>
    defer rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">var</span> name string
         <span class="token keyword">var</span> id int
        <span class="token keyword">if</span> err <span class="token punctuation">:</span><span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//fmt.Printf(&quot;name:%s ,id:is %d\n&quot;, name, id)</span>
    <span class="token punctuation">}</span>
    end <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式1 query total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式2 query</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT uid,username FROM USER&quot;</span><span class="token punctuation">)</span>
    defer stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    rows<span class="token punctuation">,</span>_ <span class="token operator">=</span> stm<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    defer rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">var</span> name string
         <span class="token keyword">var</span> id int
        <span class="token keyword">if</span> err <span class="token punctuation">:</span><span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
       <span class="token comment">// fmt.Printf(&quot;name:%s ,id:is %d\n&quot;, name, id)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式2 query total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    
    <span class="token comment">//方式3 query</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    defer tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    rows<span class="token punctuation">,</span>_ <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT uid,username FROM USER&quot;</span><span class="token punctuation">)</span>
    defer rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">var</span> name string
         <span class="token keyword">var</span> id int
        <span class="token keyword">if</span> err <span class="token punctuation">:</span><span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//fmt.Printf(&quot;name:%s ,id:is %d\n&quot;, name, id)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式3 query total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

func <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">//方式1 insert</span>
    <span class="token comment">//strconv,int转string:strconv.Itoa(i)</span>
    start <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        <span class="token comment">//每次循环内部都会去连接池获取一个新的连接，效率低下</span>
        db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO user(uid,username,age) values(?,?,?)&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token punctuation">:</span><span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式1 insert total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式2 insert</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1101</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1200</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        <span class="token comment">//Prepare函数每次循环内部都会去连接池获取一个新的连接，效率低下</span>
        stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO user(uid,username,age) values(?,?,?)&quot;</span><span class="token punctuation">)</span>
        stm<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span>
        stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式2 insert total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式3 insert</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    stm<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO user(uid,username,age) values(?,?,?)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1201</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1300</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        <span class="token comment">//Exec内部并没有去获取连接，为什么效率还是低呢？</span>
        stm<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    stm<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式3 insert total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式4 insert</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//Begin函数内部会去获取连接</span>
    tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1301</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1400</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        <span class="token comment">//每次循环用的都是tx内部的连接，没有新建连接，效率高</span>
        tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO user(uid,username,age) values(?,?,?)&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//最后释放tx内部的连接</span>
    tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式4 insert total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">//方式5 insert</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">1401</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1500</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">{</span>
        <span class="token comment">//Begin函数每次循环内部都会去连接池获取一个新的连接，效率低下</span>
        tx<span class="token punctuation">,</span>_ <span class="token punctuation">:</span><span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        tx<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO user(uid,username,age) values(?,?,?)&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token comment">//Commit执行后连接也释放了</span>
        tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;方式5 insert total time:&quot;</span><span class="token punctuation">,</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="深入内部分析原因分析"><a href="#深入内部分析原因分析" aria-hidden="true" class="header-anchor">#</a> 深入内部分析原因分析</h4> <ol><li>sql.Open(&quot;mysql&quot;, &quot;username:pwd@/databasename&quot;)</li></ol> <p>功能：返回一个DB对象，DB对象对于多个goroutines并发使用是安全的，DB对象内部封装了连接池。</p> <p>实现：open函数并没有创建连接，它只是验证参数是否合法。然后开启一个单独goroutines去监听是否需要建立新的连接，当有请求建立新连接时就创建新连接。</p> <p>注意：open函数应该被调用一次，通常是没必要close的。</p> <ol start="2"><li><p>DB.Exec()</p> <pre><code> 功能：执行不返回行（row）的查询，比如INSERT，UPDATE，DELETE

 实现：DB交给内部的exec方法负责查询。exec会首先调用DB内部的conn方法从连接池里面获得一个连接。然后检查内部的driver.Conn实现了Execer接口没有，如果实现了该接口，会调用Execer接口的Exec方法执行查询；否则调用Conn接口的Prepare方法负责查询。
</code></pre></li> <li><p>DB.Query()</p> <pre><code> 功能：用于检索（retrieval），比如SELECT

 实现：DB交给内部的query方法负责查询。query首先调用DB内部的conn方法从连接池里面获得一个连接，然后调用内部的queryConn方法负责查询。
</code></pre></li> <li><p>DB.QueryRow()</p> <pre><code> 功能：用于返回单行的查询

 实现：转交给DB.Query()查询
</code></pre></li> <li><p>db.Prepare()</p> <pre><code> 功能：返回一个Stmt。Stmt对象可以执行Exec,Query,QueryRow等操作。

 实现：DB交给内部的prepare方法负责查询。prepare首先调用DB内部的conn方法从连接池里面获得一个连接，然后调用driverConn的prepareLocked方法负责查询。

 Stmt相关方法：

 st.Exec()

 st.Query()

 st.QueryRow()

 st.Close()
</code></pre></li> <li><p>db.Begin()</p> <pre><code> 功能：开启事务，返回Tx对象。调用该方法后，这个TX就和指定的连接绑定在一起了。一旦事务提交或者回滚，该事务绑定的连接就还给DB的连接池。

 实现：DB交给内部的begin方法负责处理。begin首先调用DB内部的conn方法从连接池里面获得一个连接，然后调用Conn接口的Begin方法获得一个TX。

 TX相关方法：

 //内部执行流程和上面那些差不多，只是没有先去获取连接的一步，因为这些操作是和TX关联的，Tx建立的时候就和一个连接绑定了，所以这些操作内部共用一个TX内部的连接。

 tx.Exec() 

 tx.Query()

 tx.QueryRow()

 tx.Prepare()

 tx.Commit()

 tx.Rollback()

 tx.Stmt()//用于将一个已存在的statement和tx绑定在一起。一个statement可以不和tx关联，比如db.Prepare()返回的statement就没有和TX关联。
</code></pre></li></ol> <p>例子：</p> <pre><code>updateMoney, err := db.Prepare(&quot;UPDATE balance SET money=money+? WHERE id=?&quot;)

...

tx, err := db.Begin()

...

res, err := tx.Stmt(updateMoney).Exec(123.45, 98293203)
</code></pre> <ol><li><p>源码中Stmt的定义</p> <pre><code> type Stmt struct {

  // Immutable:

  db        *DB    // where we came from

  query     string // that created the Stmt

  stickyErr error  // if non-nil, this error is returned for all operations



  closemu sync.RWMutex // held exclusively during close, for read otherwise.



  // If in a transaction, else both nil:

  tx   *Tx

  txsi *driverStmt



  mu     sync.Mutex // protects the rest of the fields

  closed bool



  // css is a list of underlying driver statement interfaces

  // that are valid on particular connections.  This is only

  // used if tx == nil and one is found that has idle

  // connections.  If tx != nil, txsi is always used.

  css []connStmt
 }
</code></pre></li></ol> <h2 id="golang-数据库模型图"><a href="#golang-数据库模型图" aria-hidden="true" class="header-anchor">#</a> golang 数据库模型图</h2> <p><img src="/assets/img/070012140173654.6179cb30.png" alt="img"></p> <p><a href="https://www.cnblogs.com/shiluoliming/p/7904547.html" target="_blank" rel="noopener noreferrer">引用链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="数据库数据为-null-的问题"><a href="#数据库数据为-null-的问题" aria-hidden="true" class="header-anchor">#</a> 数据库数据为 null 的问题</h2> <p><a href="https://blog.csdn.net/robertkun/article/details/79157599" target="_blank" rel="noopener noreferrer">数据库为 null 的问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.a63e0d5d.js" defer></script><script src="/assets/js/3.997b8ea5.js" defer></script>
  </body>
</html>
