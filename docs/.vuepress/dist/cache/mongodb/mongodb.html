<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDb | Touch</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.e521e81d.css" as="style"><link rel="preload" href="/blog/assets/js/app.de8fea69.js" as="script"><link rel="preload" href="/blog/assets/js/15.f5740721.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.7d9a6c70.js"><link rel="prefetch" href="/blog/assets/js/11.1f1bc55f.js"><link rel="prefetch" href="/blog/assets/js/12.46046755.js"><link rel="prefetch" href="/blog/assets/js/13.1f67bf95.js"><link rel="prefetch" href="/blog/assets/js/14.a09ad8be.js"><link rel="prefetch" href="/blog/assets/js/16.0865bd12.js"><link rel="prefetch" href="/blog/assets/js/17.68a80669.js"><link rel="prefetch" href="/blog/assets/js/18.334cbbf6.js"><link rel="prefetch" href="/blog/assets/js/19.b6340308.js"><link rel="prefetch" href="/blog/assets/js/2.9c7bbb20.js"><link rel="prefetch" href="/blog/assets/js/20.7f17745f.js"><link rel="prefetch" href="/blog/assets/js/21.17b21b39.js"><link rel="prefetch" href="/blog/assets/js/22.2a8fad0a.js"><link rel="prefetch" href="/blog/assets/js/23.27ae9968.js"><link rel="prefetch" href="/blog/assets/js/24.04f56062.js"><link rel="prefetch" href="/blog/assets/js/25.90a5e45f.js"><link rel="prefetch" href="/blog/assets/js/26.b8870966.js"><link rel="prefetch" href="/blog/assets/js/27.7ba04ce1.js"><link rel="prefetch" href="/blog/assets/js/28.5edf767e.js"><link rel="prefetch" href="/blog/assets/js/29.a1f0c936.js"><link rel="prefetch" href="/blog/assets/js/3.f7a9c409.js"><link rel="prefetch" href="/blog/assets/js/30.58cf10ea.js"><link rel="prefetch" href="/blog/assets/js/31.7d6a1721.js"><link rel="prefetch" href="/blog/assets/js/32.4af00e44.js"><link rel="prefetch" href="/blog/assets/js/33.483ce936.js"><link rel="prefetch" href="/blog/assets/js/34.540ed799.js"><link rel="prefetch" href="/blog/assets/js/35.fc0363fe.js"><link rel="prefetch" href="/blog/assets/js/36.33bcfce3.js"><link rel="prefetch" href="/blog/assets/js/37.16c782f2.js"><link rel="prefetch" href="/blog/assets/js/38.e7d2b0e3.js"><link rel="prefetch" href="/blog/assets/js/39.ff0b25c6.js"><link rel="prefetch" href="/blog/assets/js/4.6e760682.js"><link rel="prefetch" href="/blog/assets/js/40.2baa50b7.js"><link rel="prefetch" href="/blog/assets/js/41.a2a62ce7.js"><link rel="prefetch" href="/blog/assets/js/42.8e489eb5.js"><link rel="prefetch" href="/blog/assets/js/43.77d90f1d.js"><link rel="prefetch" href="/blog/assets/js/44.ad4aaef8.js"><link rel="prefetch" href="/blog/assets/js/5.9dd8574d.js"><link rel="prefetch" href="/blog/assets/js/6.48d98ab7.js"><link rel="prefetch" href="/blog/assets/js/7.bdb9ab0f.js"><link rel="prefetch" href="/blog/assets/js/8.d380d5c0.js"><link rel="prefetch" href="/blog/assets/js/9.2a931bbc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e521e81d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Touch</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/golang.html" class="nav-link">golang</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/redis.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/mogodb.html" class="nav-link">mogodb</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/database.html" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/web.html" class="nav-link">web</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">mogodb</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cache/mongodb/mongodb.html" class="nav-link router-link-exact-active router-link-active">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">redis</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cache/redis/redis.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/blog/cache/redis/leveldb.html" class="nav-link">LevelDB</a></li><li class="dropdown-item"><!----> <a href="/blog/cache/redis/rocksdb.html" class="nav-link">RocksDB</a></li></ul></div></div><div class="nav-item"><a href="/blog/peddle_self/production/document.html" class="nav-link">数据库表</a></div><div class="nav-item"><a href="/blog/weex/weex.html" class="nav-link">weex</a></div><div class="nav-item"><a href="/blog/cluster/cluster.html" class="nav-link">集群</a></div><div class="nav-item"><a href="/blog/server/server.html" class="nav-link">服务器</a></div><div class="nav-item"><a href="/blog/vue/primary/primary.html" class="nav-link">vue入门</a></div><div class="nav-item"><a href="/blog/arithmetic/home.html" class="nav-link">算法</a></div><div class="nav-item"><a href="/blog/javaoc/javaoc.html" class="nav-link">j2objc</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">issue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/issue/vue.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/blog/issue/golang.html" class="nav-link">golang</a></li><li class="dropdown-item"><!----> <a href="/blog/issue/mysql.html" class="nav-link">mysql</a></li></ul></div></div><div class="nav-item"><a href="/blog/golang/learning.html" class="nav-link">golang</a></div><div class="nav-item"><a href="/blog/webpack/learning.html" class="nav-link">webpack</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/golang.html" class="nav-link">golang</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/redis.html" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/mogodb.html" class="nav-link">mogodb</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/database.html" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/blog/peddle_self/dashboard/web.html" class="nav-link">web</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">mogodb</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cache/mongodb/mongodb.html" class="nav-link router-link-exact-active router-link-active">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">redis</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cache/redis/redis.html" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/blog/cache/redis/leveldb.html" class="nav-link">LevelDB</a></li><li class="dropdown-item"><!----> <a href="/blog/cache/redis/rocksdb.html" class="nav-link">RocksDB</a></li></ul></div></div><div class="nav-item"><a href="/blog/peddle_self/production/document.html" class="nav-link">数据库表</a></div><div class="nav-item"><a href="/blog/weex/weex.html" class="nav-link">weex</a></div><div class="nav-item"><a href="/blog/cluster/cluster.html" class="nav-link">集群</a></div><div class="nav-item"><a href="/blog/server/server.html" class="nav-link">服务器</a></div><div class="nav-item"><a href="/blog/vue/primary/primary.html" class="nav-link">vue入门</a></div><div class="nav-item"><a href="/blog/arithmetic/home.html" class="nav-link">算法</a></div><div class="nav-item"><a href="/blog/javaoc/javaoc.html" class="nav-link">j2objc</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">issue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/issue/vue.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/blog/issue/golang.html" class="nav-link">golang</a></li><li class="dropdown-item"><!----> <a href="/blog/issue/mysql.html" class="nav-link">mysql</a></li></ul></div></div><div class="nav-item"><a href="/blog/golang/learning.html" class="nav-link">golang</a></div><div class="nav-item"><a href="/blog/webpack/learning.html" class="nav-link">webpack</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/cache/mongodb/mongodb.html" class="active sidebar-link">MongoDb</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#基本操作" class="sidebar-link">基本操作</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#创建集合" class="sidebar-link">创建集合</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#插入文档" class="sidebar-link">插入文档</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#更新文档" class="sidebar-link">更新文档</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#更多跟新示例" class="sidebar-link">更多跟新示例</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#mongodb-删除文档" class="sidebar-link">MongoDB 删除文档</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#查询文档" class="sidebar-link">查询文档</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#type-操作符号" class="sidebar-link">$type 操作符号</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#limit-and-skip" class="sidebar-link">limit and skip</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#sort-排序" class="sidebar-link">sort 排序</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#聚合" class="sidebar-link">聚合</a></li><li class="sidebar-sub-header"><a href="/blog/cache/mongodb/mongodb.html#通道-注意：-有待写更多的-demo" class="sidebar-link">通道(注意： 有待写更多的 demo)</a></li></ul></li><li><a href="/blog/cache/mongodb/intermediate.html" class="sidebar-link">mongo 中级</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="mongodb"><a href="#mongodb" aria-hidden="true" class="header-anchor">#</a> MongoDb</h1> <p>前提：</p> <ol><li>进入 mongo docker</li> <li><code>mongo</code> 命令进入 mongo 的命令操作界面</li></ol> <h2 id="基本操作"><a href="#基本操作" aria-hidden="true" class="header-anchor">#</a> 基本操作</h2> <ul><li>查看数据库命令</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>dbs
</code></pre></div><ul><li>创建数据库, 切换数据库，没有数据库时候创建数据库</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>use DATABASE_NAME
</code></pre></div><ul><li>删除数据库</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.dropDatabase()
</code></pre></div><ul><li>创建 collection, 类似 mysql 中的table</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.createCollection(&quot;table_name&quot;)
</code></pre></div><ul><li>向 collection 中插入数据</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.table_name.insert({&quot;name&quot;: &quot;alex&quot;, &quot;age&quot;: 12})
</code></pre></div><ul><li>查看当前数据库中有哪些 collection</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>show tables
show collections
</code></pre></div><ul><li>删除 collection</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.table_name.drop()
</code></pre></div><h2 id="创建集合"><a href="#创建集合" aria-hidden="true" class="header-anchor">#</a> 创建集合</h2> <div class="language-mongo extra-class"><pre class="language-text"><code>db.createCollection(name, options)
</code></pre></div><ul><li>name: 要创建的集合名称</li> <li>options: 可选参数, 指定有关内存大小及索引的选项</li></ul> <table><thead><tr><th>字段</th> <th style="text-align:center">类型</th> <th style="text-align:left">描述</th></tr></thead> <tbody><tr><td>capped</td> <td style="text-align:center">布尔</td> <td style="text-align:left">（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。当该值为 true 时，必须指定 size 参数。</td></tr> <tr><td>autoIndexId</td> <td style="text-align:center">布尔</td> <td style="text-align:left">（可选）如为 true，自动在 _id 字段创建索引。默认为 false。</td></tr> <tr><td>size</td> <td style="text-align:center">数值</td> <td style="text-align:left">（可选）为固定集合指定一个最大值，以千字节计（KB）。如果 capped 为 true，也需要指定该字段。</td></tr> <tr><td>max</td> <td style="text-align:center">数值</td> <td style="text-align:left">（可选）指定固定集合中包含文档的最大数量。</td></tr></tbody></table> <ul><li>创建固定集合 mycol，整个集合空间大小 6142800 KB, 文档最大个数为 10000 个。</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.createCollection(&quot;mycol&quot;, { capped : true, autoIndexId : true, size : 6142800, max : 10000 } )
</code></pre></div><h2 id="插入文档"><a href="#插入文档" aria-hidden="true" class="header-anchor">#</a> 插入文档</h2> <div class="language-MongoDb extra-class"><pre class="language-text"><code>db.col.insert({title: 'MongoDB 教程',
    description: 'MongoDB 是一个 Nosql 数据库',
    by: '菜鸟教程',
    url: 'http://www.runoob.com',
    tags: ['mongodb', 'database', 'NoSQL'],
    likes: 100
})

db.col.find()
</code></pre></div><h2 id="更新文档"><a href="#更新文档" aria-hidden="true" class="header-anchor">#</a> 更新文档</h2> <div class="language-mongo extra-class"><pre class="language-text"><code>db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;
   }
)
</code></pre></div><p>query : update的查询条件，类似sql update查询内where后面的。
update : update的对象和一些更新的操作符（如$,$inc...）等，也可以理解为sql update查询内set后面的
upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。
multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。
writeConcern :可选，抛出异常的级别。</p> <ul><li>更新命令-相同的数据每次只可以修改一条记录</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.update({'title':'MongoDB 教程'},{$set:{'title':'MongoDB'}})
</code></pre></div><ul><li>更新命令修改多行</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.update({'title':'MongoDB 教程'},{$set:{'title':'MongoDB'}}, {multi: true})
</code></pre></div><ul><li>save() 传入替换已有的文档</li></ul> <p>document : 文档数据。
writeConcern :可选，抛出异常的级别。</p> <div class="language-mongo extra-class"><pre class="language-text"><code>db.collection.save(
   &lt;document&gt;,
   {
     writeConcern: &lt;document&gt;
   }
)
</code></pre></div><p>修改 _id = ObjectId(&quot;56064f89ade2f21f36b03136&quot;) 的数据</p> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find().pretty()
{
        &quot;_id&quot; : ObjectId(&quot;56064f89ade2f21f36b03136&quot;),
        &quot;title&quot; : &quot;MongoDB&quot;,
        &quot;description&quot; : &quot;MongoDB 是一个 Nosql 数据库&quot;,
        &quot;by&quot; : &quot;Runoob&quot;,
        &quot;url&quot; : &quot;http://www.runoob.com&quot;,
        &quot;tags&quot; : [
                &quot;mongodb&quot;,
                &quot;NoSQL&quot;
        ],
        &quot;likes&quot; : 110
}
</code></pre></div><ul><li>格式化查找 collection 中的数据</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find().pretty()
</code></pre></div><h2 id="更多跟新示例"><a href="#更多跟新示例" aria-hidden="true" class="header-anchor">#</a> 更多跟新示例</h2> <div class="language-mongo extra-class"><pre class="language-text"><code>更多实例
只更新第一条记录：

db.col.update( { &quot;count&quot; : { $gt : 1 } } , { $set : { &quot;test2&quot; : &quot;OK&quot;} } );
全部更新：

db.col.update( { &quot;count&quot; : { $gt : 3 } } , { $set : { &quot;test2&quot; : &quot;OK&quot;} },false,true );
只添加第一条：

db.col.update( { &quot;count&quot; : { $gt : 4 } } , { $set : { &quot;test5&quot; : &quot;OK&quot;} },true,false );
全部添加进去:

db.col.update( { &quot;count&quot; : { $gt : 5 } } , { $set : { &quot;test5&quot; : &quot;OK&quot;} },true,true );
全部更新：

db.col.update( { &quot;count&quot; : { $gt : 15 } } , { $inc : { &quot;count&quot; : 1} },false,true );
只更新第一条记录：

db.col.update( { &quot;count&quot; : { $gt : 10 } } , { $inc : { &quot;count&quot; : 1} },false,false );
</code></pre></div><h2 id="mongodb-删除文档"><a href="#mongodb-删除文档" aria-hidden="true" class="header-anchor">#</a> MongoDB 删除文档</h2> <ul><li>删除所有符合条件的数据</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.remove({&quot;title&quot;:&quot;MongoDB&quot;})
</code></pre></div><ul><li>删除一条符合条件的数据</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.remove({&quot;title&quot;:&quot;MongoDB&quot;}, 1)
</code></pre></div><ul><li>删除所有数据</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.remove({})
db.col.find().pretty()
</code></pre></div><h2 id="查询文档"><a href="#查询文档" aria-hidden="true" class="header-anchor">#</a> 查询文档</h2> <ul><li>query ：可选，使用查询操作符指定查询条件</li> <li>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.collection.find(query, projection)
</code></pre></div><h3 id="where"><a href="#where" aria-hidden="true" class="header-anchor">#</a> where</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find({key1:value1, key2:value2}).pretty()
</code></pre></div><table><thead><tr><th>操作</th> <th>格式</th> <th>范例</th> <th>RDBMS中的类似语句</th></tr></thead> <tbody><tr><td>等于</td> <td>{key:value}</td> <td>db.col.find({&quot;by&quot;:&quot;菜鸟教程&quot;}).pretty()</td> <td>where by = '菜鸟教程'</td></tr> <tr><td>小于</td> <td>{key:{$lt:value}}</td> <td>db.col.find({&quot;likes&quot;:{$lt:50}}).pretty()</td> <td>where likes &lt; 50</td></tr> <tr><td>小于或等于</td> <td>{key:{$lte:value}}</td> <td>db.col.find({&quot;likes&quot;:{$lte:50}}).pretty()</td> <td>where likes &lt;= 50</td></tr> <tr><td>大于</td> <td>{key:{$gt:value}}</td> <td>db.col.find({&quot;likes&quot;:{$gt:50}}).pretty()</td> <td>where likes &gt; 50</td></tr> <tr><td>大于或等于</td> <td>{key:{$gte:value}}</td> <td>db.col.find({&quot;likes&quot;:{$gte:50}}).pretty()</td> <td>where likes &gt;= 50</td></tr> <tr><td>不等于</td> <td>{key:{$ne:value}}</td> <td>db.col.find({&quot;likes&quot;:{$ne:50}}).pretty()</td> <td>where likes != 50</td></tr></tbody></table> <h3 id="where-and"><a href="#where-and" aria-hidden="true" class="header-anchor">#</a> where and</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find({key1:value1, key2:value2}).pretty()
db.col.find({&quot;by&quot;:&quot;菜鸟教程&quot;, &quot;title&quot;:&quot;MongoDB 教程&quot;}).pretty()
</code></pre></div><h3 id="where-or"><a href="#where-or" aria-hidden="true" class="header-anchor">#</a> where or</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find(
   {
      $or: [
         {key1: value1}, {key2:value2}
      ]
   }
).pretty()
db.col.find({$or:[{&quot;by&quot;:&quot;菜鸟教程&quot;},{&quot;title&quot;: &quot;MongoDB 教程&quot;}]}).pretty()
</code></pre></div><h3 id="where-or-and-and"><a href="#where-or-and-and" aria-hidden="true" class="header-anchor">#</a> where or and and</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find({&quot;likes&quot;: {$gt:50}, $or: [{&quot;by&quot;: &quot;菜鸟教程&quot;},{&quot;title&quot;: &quot;MongoDB 教程&quot;}]}).pretty()
</code></pre></div><h2 id="type-操作符号"><a href="#type-操作符号" aria-hidden="true" class="header-anchor">#</a> $type 操作符号</h2> <ul><li>type 有很多类型； 1-Double, 2-string</li> <li>其他判断 <a href="https://www.runoob.com/mongodb/mongodb-operators-type.html" target="_blank" rel="noopener noreferrer">type 操作符号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find({&quot;title&quot; : {$type : 2}})
或
db.col.find({&quot;title&quot; : {$type : 'string'}})
</code></pre></div><h2 id="limit-and-skip"><a href="#limit-and-skip" aria-hidden="true" class="header-anchor">#</a> limit and skip</h2> <ul><li>limit: 限制查询数量</li> <li>skip: 跳过多少条数据</li></ul> <h3 id="limit"><a href="#limit" aria-hidden="true" class="header-anchor">#</a> limit</h3> <div class="language-MongoDb extra-class"><pre class="language-text"><code>db.col.find({},{&quot;title&quot;:1,_id:0}).limit(2)
</code></pre></div><h3 id="skip"><a href="#skip" aria-hidden="true" class="header-anchor">#</a> skip</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.find({},{&quot;title&quot;:1,_id:0}).limit(1).skip(1)
</code></pre></div><h2 id="sort-排序"><a href="#sort-排序" aria-hidden="true" class="header-anchor">#</a> sort 排序</h2> <ul><li>1 为升序</li> <li>-1 为降序</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.COLLECTION_NAME.find().sort({KEY:1})
</code></pre></div><h2 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h2> <ul><li>目的：极大的提高查询效率。</li> <li>原因：数据库可以根据索引，整理数据(排序、红黑树、B树、B+树 等)</li> <li>以下将 col 表中的 title 升序排列，description 降序排列(复合索引)</li> <li>background:true, 在后台创建索引，防止创建索引的过程中，阻塞其他数据库操作，当然还有其他的参数</li> <li><a href="https://www.runoob.com/mongodb/mongodb-indexing.html" target="_blank" rel="noopener noreferrer">其他索引参数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code> db.col.createIndex({&quot;title&quot;:1,&quot;description&quot;:-1}, {&quot;background&quot;: true})
</code></pre></div><h2 id="聚合"><a href="#聚合" aria-hidden="true" class="header-anchor">#</a> 聚合</h2> <ul><li>MongoDB中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似sql语句中的 count(*)。</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)
</code></pre></div><ul><li>现在我们通过以上集合计算每个作者所写的文章数，使用aggregate()计算结果如下：</li></ul> <div class="language-mongo extra-class"><pre class="language-text"><code>{
   _id: ObjectId(7df78ad8902c)
   title: 'MongoDB Overview', 
   description: 'MongoDB is no sql database',
   by_user: 'runoob.com',
   url: 'http://www.runoob.com',
   tags: ['mongodb', 'database', 'NoSQL'],
   likes: 100
},
{
   _id: ObjectId(7df78ad8902d)
   title: 'NoSQL Overview', 
   description: 'No sql database is very fast',
   by_user: 'runoob.com',
   url: 'http://www.runoob.com',
   tags: ['mongodb', 'database', 'NoSQL'],
   likes: 10
},
{
   _id: ObjectId(7df78ad8902e)
   title: 'Neo4j Overview', 
   description: 'Neo4j is no sql database',
   by_user: 'Neo4j',
   url: 'http://www.neo4j.com',
   tags: ['neo4j', 'database', 'NoSQL'],
   likes: 750
}

db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : 1}}}])
{
   &quot;result&quot; : [
      {
         &quot;_id&quot; : &quot;runoob.com&quot;,
         &quot;num_tutorial&quot; : 2
      },
      {
         &quot;_id&quot; : &quot;Neo4j&quot;,
         &quot;num_tutorial&quot; : 1
      }
   ],
   &quot;ok&quot; : 1
}
</code></pre></div><h3 id="其他表达式"><a href="#其他表达式" aria-hidden="true" class="header-anchor">#</a> 其他表达式</h3> <table><thead><tr><th>表达式</th> <th>描述</th> <th>实例</th></tr></thead> <tbody><tr><td>$sum</td> <td>计算总和。</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : &quot;$likes&quot;}}}])</td></tr> <tr><td>$avg</td> <td>计算平均值</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$avg : &quot;$likes&quot;}}}])</td></tr> <tr><td>$min</td> <td>获取集合中所有文档对应值得最小值。</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$min : &quot;$likes&quot;}}}])</td></tr> <tr><td>$max</td> <td>获取集合中所有文档对应值得最大值。</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$max : &quot;$likes&quot;}}}])</td></tr> <tr><td>$push</td> <td>在结果文档中插入值到一个数组中。</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$push: &quot;$url&quot;}}}])</td></tr> <tr><td>$addToSet</td> <td>在结果文档中插入值到一个数组中，但不创建副本。</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$addToSet : &quot;$url&quot;}}}])</td></tr> <tr><td>$first</td> <td>根据资源文档的排序获取第一个文档数据。</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, first_url : {$first : &quot;$url&quot;}}}])</td></tr> <tr><td>$last</td> <td>根据资源文档的排序获取最后一个文档数据</td> <td>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, last_url : {$last : &quot;$url&quot;}}}])</td></tr> <tr><td>$match</td> <td>使用MongoDB的标准查询操作。</td> <td>--</td></tr> <tr><td>$limit</td> <td>用来限制MongoDB聚合管道返回的文档数。</td> <td>--</td></tr> <tr><td>$skip</td> <td>在聚合管道中跳过指定数量的文档，并返回余下的文档。</td> <td>--</td></tr> <tr><td>$unwind</td> <td>将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</td> <td>--</td></tr> <tr><td>$group</td> <td>将集合中的文档分组，可用于统计结果。</td> <td>--</td></tr> <tr><td>$sort</td> <td>将输入文档排序后输出。</td> <td>--</td></tr> <tr><td>$geoNear</td> <td>输出接近某一地理位置的有序文档。</td> <td>--</td></tr></tbody></table> <h3 id="aggregate、-match-代替-find"><a href="#aggregate、-match-代替-find" aria-hidden="true" class="header-anchor">#</a> aggregate、$match 代替 find()</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.col.aggregate([{$match:{&quot;age&quot;:{$gt:12}}}]).pretty()
</code></pre></div><h3 id="查询数量"><a href="#查询数量" aria-hidden="true" class="header-anchor">#</a> 查询数量</h3> <div class="language-mongo extra-class"><pre class="language-text"><code>db.module2.find().count()
</code></pre></div><h2 id="通道-注意：-有待写更多的-demo"><a href="#通道-注意：-有待写更多的-demo" aria-hidden="true" class="header-anchor">#</a> 通道(注意： 有待写更多的 demo)</h2> <p>管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的参数。
MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。
表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。</p> <p>$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。
$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。
$limit：用来限制MongoDB聚合管道返回的文档数。
$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。
$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。
$group：将集合中的文档分组，可用于统计结果。
$sort：将输入文档排序后输出。
$geoNear：输出接近某一地理位置的有序文档。</p> <div class="language-mongo extra-class"><pre class="language-text"><code>db.article.aggregate(
    { $project : {
        title : 1 ,
        author : 1 ,
    }}
 );
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/cache/mongodb/intermediate.html">
          mongo 中级
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.de8fea69.js" defer></script><script src="/blog/assets/js/15.f5740721.js" defer></script>
  </body>
</html>
